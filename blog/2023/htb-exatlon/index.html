<!DOCTYPE html>
<html lang="en">

  <!-- Head -->
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Hack the Box - Exatlon Writeup | Landen Doty</title>
    <meta name="author" content="Landen  Doty">
    <meta name="description" content="Challenge writeup">


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light">

    <!-- Styles -->
    
    <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://landoty.github.io/blog/2023/htb-exatlon/">
    
    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark">

    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
    

  </head>

  <!-- Body -->
  <body class="fixed-top-nav sticky-bottom-footer">

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="/">Landen Doty</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">about</a>
              </li>
              
              <!-- Blog -->
              <li class="nav-item active">
                <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a>
              </li>

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/projects/">projects</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/cv/">cv</a>
              </li>

              <!-- Toogle theme mode -->
              <li class="toggle-container">
                <button id="light-toggle" title="Change theme">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Scrolling Progress Bar -->
      <progress id="progress" value="0">
        <div class="progress-container">
          <span class="progress-bar"></span>
        </div>
      </progress>
    </header>


    <!-- Content -->
    <div class="container mt-5">
      <!-- _layouts/post.html -->

<div class="post">

  <header class="post-header">
    <h1 class="post-title">Hack the Box - Exatlon Writeup</h1>
    <p class="post-meta">May 26, 2023</p>
    <p class="post-tags">
      <a href="/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a>
        ·  
        <a href="/blog/tag/ctf">
          <i class="fas fa-hashtag fa-sm"></i> ctf</a>  
          

    </p>
  </header>

  <article class="post-content">
    <h3 id="initial-analysis">Initial Analysis</h3>

<p>Download the challenge materials from Hack the Box, create a directory, extract, ready to go. We get a single executable, <em>exatlon_v1</em>. Run <em>file</em> to see what we’re working with.</p>

<p><img src="/assets/img/blog/htb-exatlon-1.png" class="img-fluid"></p>

<p>No section header AND statically linked?? Let’s toss it in IDA and see what’s going on…</p>

<p><img src="/assets/img/blog/htb-exatlon-2.png" class="img-fluid"></p>

<p>Ok, yep, this is a mess. The binary has pretty clearly been compressed or packed. Recently, I’ve been utilizing IDA’s string view instead of the default Unix <em>strings</em> command. Let’s see what we get.</p>

<p><img src="/assets/img/blog/htb-exatlon-3.png" class="img-fluid"></p>

<p>Ahhhh, there we go. <a href="https://github.com/upx/upx" rel="external nofollow noopener" target="_blank">UPX</a>, the <em>“Ultimate Packer for eXecutables”</em> was used here to compress the binary. After downloading the repo and building from source, UPX also provides a decompress or unpack option. Use this and reload the new binary into IDA.</p>

<p><img src="/assets/img/blog/htb-exatlon-4.png" class="img-fluid"></p>

<h3 id="source-analysis">Source Analysis</h3>

<blockquote>
  <p><strong>NOTE:</strong> Recall the binary is statically linked, so whichever libraries are included to make it work will be fully compiled into the binary and included in IDA’s analysis.</p>
</blockquote>

<p>After loading the decompressed binary, we see all of those imports. Note the name mangling, so we’re working with a binary compiled from C++! Thankfully, it’s not stripped, so let’s find the <em>main</em> function and see what’s going on.</p>

<p><img src="/assets/img/blog/htb-exatlon-5.png" class="img-fluid"></p>

<p>If you expand the image above from IDA, you can see that after prompting for the password, a call is made to function <em>exatlon</em>, followed by a (wacky) overloaded <em>==</em>. Also following the call to <em>exatlon</em>, a strange string of numbers.</p>

<p>Now, I should admit the rabbit hole I went down, trying to understand the various standard libary classes used here (char_traits, basic_string, etc.) to make sense of the equivalence operator. After a bit of frustration, I figured it was time for dynamic analysis…</p>

<h3 id="dynamic-analysis-in-gdb">Dynamic Analysis in GDB</h3>

<p>The workflow here isn’t too complicated…set a breakpoint for the instruction following the call to <em>exatlon</em>, walkthrough the next few instructions before the <em>==</em> operator, and check out the registers.</p>

<p>When running, just give a single character; I did ‘a’.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>b exatlon(std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const&amp;)
run
step
ni 2
info registers
</code></pre></div></div>
<p>At this point, the registers don’t look too promising…shouldn’t <em>rax</em> just have 0x61? If you’re running a standard gdb configuration, it might not be too obvious, but thanks to <a href="https://hugsy.github.io/gef/" rel="external nofollow noopener" target="_blank">gef</a>, or <em>GDB Enhanced Features</em>, this one jumped out at me pretty clearly.</p>

<p><img src="/assets/img/blog/htb-exatlon-7.png" class="img-fluid"></p>

<p>What the function <em>exatlon</em> is doing, is actually returning a string via a char pointer (char *). We can confirm this by examining the value of <em>rax</em>. Note, I use char ** here as <em>rax</em> contains a pointer to the string.</p>

<p><img src="/assets/img/blog/htb-exatlon-8.png" class="img-fluid"></p>

<p>Here, I make an assumption that <em>exatlon</em> takes an input string, does some defined computation on it, and returns a string derived from that computation. Then, the input-derived string is compared with the string we see loaded into <em>rsi</em> in which the program terminates on a match.</p>

<h3 id="solution">Solution</h3>

<p>So, if we can get the “exatlon-d” representation of <em>every</em> ASCII character, we can just map each value in the string being compared to it’s ASCII representation. This should get the flag.</p>

<ol>
  <li>
    <p>Get all <em>printable</em> ASCII characters</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> python3 <span class="nt">-c</span> <span class="s1">'for i in range(33,127):print(chr(i), end="")'</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Run binary inside gdb, giving the ascii characters as the “password”</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> b exatlon(std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const&amp;)
 run
 step
 ni 2
</code></pre></div>    </div>
  </li>
  <li>
    <p>Inspect the value of <em>rax</em> to get the “exatlon-d” string</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> x/s *(char **)$rax
</code></pre></div>    </div>
  </li>
  <li>
    <p>Script for solution</p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="c1"># Printable ascii chars and their representations after going through exatlon function
</span> <span class="n">ascii_chars</span> <span class="o">=</span> <span class="sh">"</span><span class="s">!</span><span class="se">\"</span><span class="s">#$%&amp;</span><span class="sh">'</span><span class="s">()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~</span><span class="sh">"</span>
 <span class="n">ascii_chars_exatlon</span> <span class="o">=</span> <span class="sh">"</span><span class="s">528 544 560 576 592 608 624 640 656 672 688 704 720 736 752 768 784 800 816 832 848 864 880 896 912 928 944 960 976 992 1008 1024 1040 1056 1072 1088 1104 1120 1136 1152 1168 1184 1200 1216 1232 1248 1264 1280 1296 1312 1328 1344 1360 1376 1392 1408 1424 1440 1456 1472 1488 1504 1520 1536 1552 1568 1584 1600 1616 1632 1648 1664 1680 1696 1712 1728 1744 1760 1776 1792 1808 1824 1840 1856 1872 1888 1904 1920 1936 1952 1968 1984 2000 2016</span><span class="sh">"</span>

 <span class="c1"># Exatlon-form flag found in binary
</span> <span class="n">flag_exatlon</span> <span class="o">=</span> <span class="sh">"</span><span class="s">1152 1344 1056 1968 1728 816 1648 784 1584 816 1728 1520 1840 1664 784 1632 1856 1520 1728 816 1632 1856 1520 784 1760 1840 1824 816 1584 1856 784 1776 1760 528 528 2000</span><span class="sh">"</span>

 <span class="c1"># list-ify each
</span> <span class="n">ascii_chars</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">ascii_chars</span><span class="p">)</span>
 <span class="n">ascii_chars_exatlon</span> <span class="o">=</span> <span class="n">ascii_chars_exatlon</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s"> </span><span class="sh">"</span><span class="p">)</span>
 <span class="n">flag_exatlon</span> <span class="o">=</span> <span class="n">flag_exatlon</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s"> </span><span class="sh">"</span><span class="p">)</span>

 <span class="n">ascii_exatlon_dict</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">(</span><span class="nf">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="n">ascii_chars_exatlon</span><span class="p">,</span> <span class="n">ascii_chars</span><span class="p">))</span>

 <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">flag_exatlon</span><span class="p">:</span>
     <span class="nf">print</span><span class="p">(</span><span class="n">ascii_exatlon_dict</span><span class="p">[</span><span class="n">char</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="sh">""</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ol>

  </article>


  
    
    <br>
    <hr>
    <br>
    <ul class="list-disc pl-8"></ul>

    <!-- Adds related posts to the end of an article -->
    <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2>
    <p class="mb-2">Here are some more articles you might like to read next:</p>
  

  <li class="my-2">
    <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/what-im-reading/">Reading list (running)</a>
  </li>

  

  <li class="my-2">
    <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/pwnCollege-revEng/">Pwn.College Reverse Engineering</a>
  </li>

</div>

    </div>

    <!-- Footer -->    <footer class="sticky-bottom mt-5">
      <div class="container">
        © Copyright 2024 Landen  Doty. 
      </div>
    </footer>

    <!-- JavaScripts -->
    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Masonry & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script defer src="/assets/js/masonry.js" type="text/javascript"></script>
    
  <!-- Medium Zoom JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
  <script defer src="/assets/js/zoom.js"></script><!-- Load Common JS -->
  <script defer src="/assets/js/common.js"></script>
  <script defer src="/assets/js/copy_code.js" type="text/javascript"></script>

    

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": navbarHeight });
    $("progress-container").css({ "padding-top": navbarHeight });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>

  </body>
</html>
